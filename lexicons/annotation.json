{
  "lexicon": 1,
  "id": "app.annos.annotation",
  "description": "A single record type for all annotations.",
  "defs": {
    "main": {
      "type": "record",
      "description": "A record representing an annotation on a resource.",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["url", "field", "value"],
        "properties": {
          "url": {
            "type": "string",
            "format": "uri",
            "description": "The primary URL identifying the annotated resource."
          },
          "additionalIdentifiers": {
            "type": "array",
            "items": {
              "type": "ref",
              "ref": "#identifier"
            },
            "description": "Optional additional identifiers for the resource."
          },
          "field": {
            "type": "ref",
            "description": "A strong reference to the specific annotation field record being used.",
            "ref": "com.atproto.repo.strongRef"
          },
          "fromTemplate": {
            "type": "ref",
            "description": "Optional strong reference to the template record used.",
            "ref": "com.atproto.repo.strongRef"
          },
          "note": {
            "type": "string",
            "description": "An optional user-provided note about the annotation.",
            "maxLength": 3000
          },
          "value": {
            "type": "union",
            "description": "The specific value of the annotation, determined by the field type.",
            "refs": [
              "app.annos.defs#dyadValue",
              "app.annos.defs#triadValue",
              "app.annos.defs#ratingValue",
              "app.annos.defs#singleSelectValue",
              "app.annos.defs#multiSelectValue"
            ]
          },
          "createdAt": {
            "type": "string",
            "format": "datetime",
            "description": "Timestamp when this annotation was created (usually set by PDS)."
          }
        }
      }
    },
    "dyadValue": {
      "type": "object",
      "description": "Value structure for a dyad annotation.",
      "required": ["value"],
      "properties": {
        "value": {
          "type": "integer",
          "description": "Value representing the relationship between sides"
        },
        "minValue": {
          "type": "integer",
          "const": 0,
          "description": "Minimum possible value"
        },
        "maxValue": {
          "type": "integer",
          "const": 1,
          "description": "Maximum possible value"
        }
      }
    },
    "triadValue": {
      "type": "object",
      "description": "Value structure for a triad annotation.",
      "required": ["vertexA", "vertexB", "vertexC"],
      "properties": {
        "vertexA": { "type": "integer", "description": "Value for vertex A" },
        "vertexB": { "type": "integer", "description": "Value for vertex B" },
        "vertexC": { "type": "integer", "description": "Value for vertex C" },
        "sumsTo": {
          "type": "integer",
          "const": 1,
          "description": "The sum of all vertex values"
        }
      }
    },
    "ratingValue": {
      "type": "object",
      "description": "Value structure for a rating annotation.",
      "required": ["rating", "mustbeBetween"],
      "properties": {
        "rating": { "type": "integer", "description": "The star rating value" },
        "mustbeBetween": {
          "type": "array",
          "description": "Valid range for the rating",
          "items": { "type": "integer" },
          "minLength": 2,
          "maxLength": 2
        }
      }
    },
    "singleSelectValue": {
      "type": "object",
      "description": "Value structure for a single-select annotation.",
      "required": ["option", "mustbeOneOf"],
      "properties": {
        "option": { "type": "string", "description": "The selected option" },
        "mustbeOneOf": {
          "type": "array",
          "description": "List of valid options",
          "items": { "type": "string" }
        }
      }
    },
    "multiSelectValue": {
      "type": "object",
      "description": "Value structure for a multi-select annotation.",
      "required": ["option", "mustbeSomeOf"],
      "properties": {
        "option": {
          "type": "array",
          "description": "The selected options",
          "items": { "type": "string" }
        },
        "mustbeSomeOf": {
          "type": "array",
          "description": "List of valid options",
          "items": { "type": "string" }
        }
      }
    }
  }
}
