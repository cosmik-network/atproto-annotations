{
  "lexicon": 1,
  "id": "app.cards.card",
  "description": "A single record type for all cards.",
  "defs": {
    "main": {
      "type": "record",
      "description": "A record representing a card with content.",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["type", "content"],
        "properties": {
          "type": {
            "type": "string",
            "description": "The type of card",
            "knownValues": ["URL", "NOTE", "HIGHLIGHT"]
          },
          "content": {
            "type": "union",
            "description": "The specific content of the card, determined by the card type.",
            "refs": [
              "#urlContent",
              "#noteContent",
              "#highlightContent"
            ]
          },
          "parentCard": {
            "type": "ref",
            "description": "Optional strong reference to a parent card (for NOTE and HIGHLIGHT cards).",
            "ref": "com.atproto.repo.strongRef"
          },
          "createdAt": {
            "type": "string",
            "format": "datetime",
            "description": "Timestamp when this card was created (usually set by PDS)."
          }
        }
      }
    },
    "urlContent": {
      "type": "object",
      "description": "Content structure for a URL card.",
      "required": ["url"],
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "description": "The URL being saved"
        },
        "metadata": {
          "type": "ref",
          "ref": "#urlMetadata",
          "description": "Optional metadata about the URL"
        }
      }
    },
    "noteContent": {
      "type": "object",
      "description": "Content structure for a note card.",
      "required": ["text"],
      "properties": {
        "text": {
          "type": "string",
          "description": "The note text content",
          "maxLength": 10000
        },
        "title": {
          "type": "string",
          "description": "Optional title for the note"
        }
      }
    },
    "highlightContent": {
      "type": "object",
      "description": "Content structure for a highlight card.",
      "required": ["text", "selectors"],
      "properties": {
        "text": {
          "type": "string",
          "description": "The highlighted text",
          "maxLength": 5000
        },
        "selectors": {
          "type": "array",
          "description": "Selectors for robust anchoring of the highlight",
          "items": {
            "type": "ref",
            "ref": "#highlightSelector"
          }
        },
        "context": {
          "type": "string",
          "description": "Additional surrounding text for context"
        },
        "documentUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of the document where highlight was made"
        },
        "documentTitle": {
          "type": "string",
          "description": "Title of the document"
        }
      }
    },
    "urlMetadata": {
      "type": "object",
      "description": "Metadata about a URL.",
      "required": ["url"],
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "description": "The URL"
        },
        "title": {
          "type": "string",
          "description": "Title of the page"
        },
        "description": {
          "type": "string",
          "description": "Description of the page"
        },
        "author": {
          "type": "string",
          "description": "Author of the content"
        },
        "publishedDate": {
          "type": "string",
          "format": "datetime",
          "description": "When the content was published"
        },
        "siteName": {
          "type": "string",
          "description": "Name of the site"
        },
        "imageUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of a representative image"
        },
        "type": {
          "type": "string",
          "description": "Type of content (e.g., 'video', 'article')"
        },
        "retrievedAt": {
          "type": "string",
          "format": "datetime",
          "description": "When the metadata was retrieved"
        }
      }
    },
    "highlightSelector": {
      "type": "union",
      "description": "Different types of selectors for highlighting text.",
      "refs": [
        "#textQuoteSelector",
        "#textPositionSelector",
        "#rangeSelector"
      ]
    },
    "textQuoteSelector": {
      "type": "object",
      "description": "Selector that identifies text by exact quote with context.",
      "required": ["type", "exact"],
      "properties": {
        "type": {
          "type": "string",
          "const": "TextQuoteSelector"
        },
        "exact": {
          "type": "string",
          "description": "The exact text being selected"
        },
        "prefix": {
          "type": "string",
          "description": "Text immediately before the selection"
        },
        "suffix": {
          "type": "string",
          "description": "Text immediately after the selection"
        }
      }
    },
    "textPositionSelector": {
      "type": "object",
      "description": "Selector that identifies text by character positions.",
      "required": ["type", "start", "end"],
      "properties": {
        "type": {
          "type": "string",
          "const": "TextPositionSelector"
        },
        "start": {
          "type": "integer",
          "description": "Start character position",
          "minimum": 0
        },
        "end": {
          "type": "integer",
          "description": "End character position",
          "minimum": 0
        }
      }
    },
    "rangeSelector": {
      "type": "object",
      "description": "Selector that identifies a range using start and end selectors.",
      "required": ["type", "startSelector", "endSelector"],
      "properties": {
        "type": {
          "type": "string",
          "const": "RangeSelector"
        },
        "startSelector": {
          "type": "ref",
          "ref": "#highlightSelector",
          "description": "Selector for the start of the range"
        },
        "endSelector": {
          "type": "ref",
          "ref": "#highlightSelector",
          "description": "Selector for the end of the range"
        }
      }
    }
  }
}
